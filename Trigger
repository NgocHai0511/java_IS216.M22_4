--Khoa Lich Trinh
alter table LichTrinh
add CONSTRAINT fk_LT_gaKH FOREIGN KEY (GAKH) REFERENCES GA(maGa);
alter table LichTrinh
add CONSTRAINT fk_LT_gaKT FOREIGN KEY (GAKT) REFERENCES GA(maGa);
alter table LichTrinh
add CONSTRAINT fk_LT_MATAU FOREIGN KEY (MATAU) REFERENCES TAU(MATAU);

--Khoa Chi Tiet Ve
alter table CTVe
add CONSTRAINT Pk_CTVe PRIMARY KEY (MAVE,MAGHE);
alter table CTVe
add CONSTRAINT fk_CTVe_MaVe FOREIGN KEY (MAVE) REFERENCES VE(MAVE);
-- Loi rang buoc
--alter table CTVe
--add CONSTRAINT fk_CTVe_MaGhe FOREIGN KEY (MAGHE) REFERENCES GHE(MAGHE);

--Khoa Ve
alter table VE
add CONSTRAINT fk_Ve_MaKHang FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MaKH);
alter table VE
add CONSTRAINT fk_Ve_MaLT FOREIGN KEY (MALT) REFERENCES LICHTRINH(MALT);

--Trigger SDT
CREATE OR REPLACE TRIGGER std_tr
    BEFORE INSERT OR UPDATE OF SODT ON KHACHHANG
    FOR EACH ROW
BEGIN
    IF(:new.SODT<9)THEN
        raise_application_error(-20999,'Sai dinh dang');
    END IF;
END;
--Test Trigger SDT
--insert into khachhang values('KH04','Nguy?n ??ng Khoa','09876549','ndk123');
--Trigger VE
CREATE OR REPLACE TRIGGER ve_tr
    BEFORE INSERT  ON VE
    FOR EACH ROW
BEGIN
    IF(:new.NGAYDATVE > sysdate )THEN
        raise_application_error(-20999,'Sai dinh dang');
    END IF;
END;
--Test Trigger Ve
--insert into ve values('VE07','KH01','LT09','07/JULY/2022',900000);













